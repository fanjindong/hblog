# 401状态码拆分方案

目前有较多用户反馈无故登出的问题。

根据排查，问题锁定于：移动端的接口调用，`Authorized` 校验失败和网关的 `sign` 校验失败都会返回HTTP状态码：`401`，移动端会据此踢用户下线。

过滤网关的历史日志`grep '\" 401 .*iOS' /data/kong/logs/2019_07_15_access.log  | wc -l` 发现，每日因 `sign` 校验失败导致用户被踢下线: `1849*4=7432` 次。

另一方面，因两个逻辑复用 `401` 导致开发测试过程，无法快速定位问题。

是故，状态码的拆分刻不容缓。

## 拆分方案

经过与移动端讨论，并参考Wiki [HTTP状态码](https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81#4xx%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%94%99%E8%AF%AF)。

确定最优方案为：`Authorized` 校验失败返回 `401`， `sign` 校验失败返回 `400` .

1. 网关修改状态码为400，上线。此时线上Android遇到400会不处理，iOS会提示网络错误
2. 移动端在下个版本兼容400的返回。
