# 以对象的形式重构算法

我们通常将算法视为具有输入和输出的单个函数。
我们的算法教科书强化了这一概念，它们提供了非常简洁的，整齐地描述。
这很好，但是直到你实际去尝试将其作为单个函数实现。
一直到所有的小细节函数加起来，成为了一个巨大的，整体的功能。

单片功能缺乏可读性。
它太长了，你必须滚动一整分钟才能走到尽头。
它嵌套得如此之深，以至于您必须上下滚动才能阅读它。
几乎不可能跟踪在顶部声明的变量的状态，因为它在每隔一行都可能被操作与修改。

因此，该功能也缺乏可维护性。
任何单一的换行替换都有可能影响它下面的许多行，不可预测的方式。

没有人想要触及这个代码，因为获取任何上下文都是如此痛苦。
细节太多了。这就像通过阅读航空航天工程教科书来学习飞机一样。

复杂的代码需要抽象。
抽象有助于传达更高级别的概念，提高可读性，从而减少修复错误或添加新功能的时间。

编译器将代码作为输入并将可执行文件作为输出。
您认为编译器是作为单个单片函数实现的吗？

您的整体函数很有可能被重构为一个或多个类。
将算法实现为对象是可以的。我甚至鼓励你赶紧去做。

在这篇文章中，我将介绍一些 `代码异味:` [Code smell](https://en.wikipedia.org/wiki/Code_smell)，来建议你用一个类而不是一些单片函数。
然后用一些代码示例，分析实例的`Code smell`。最后，我将演示如何将违规函数重构为类。

## 如何判别函数是否重构

### Code smell #1. 太长或者多层嵌套

多长算长？[martinfowler](https://martinfowler.com/bliki/FunctionLength.html) 建议是10行，很多专家都同意。
它并不是绝对的说短的代码就一定有可读性，长的代码一定没有可读性。它只是有这样的一个倾向。所以我们现在建议的并不是行业准则。

就个人而言，我认为10-20行比较实际。在专业方面，我推荐同事（特别是软件开发的新手）将其保持在40行或更低。

一个好的经验法则是: `没有开发人员需要滚动来读取整个函数。`

深度嵌套也是一个值得关注的问题。在*Clean Code*，Robert C. Martin建议采用一到两级嵌套，我同意这种评估。
更深的嵌套增加了代码的[认知复杂性](https://www.sonarsource.com/resources/white-papers/cognitive-complexity.html)，这意味着它在主观上更难以理解。

### Code smell #2. 多个逻辑块

这意味着函数中有单独的逻辑块，每个逻辑块“做一件事”。
算法具有单独的逻辑部分是很好的，但在函数中这违反了[单一责任原则](https://en.wikipedia.org/wiki/Single_responsibility_principle)。

这些块已经成熟，以实际功能或lambda / closures的形式进入帮助者。如果任何块可疑地嵌套在它自己的花括号中，则代码气味会更强。如果任何块被复制粘贴到其他地方，它会更强大。
